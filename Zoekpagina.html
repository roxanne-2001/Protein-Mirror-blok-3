<!DOCTYPE html>
<html class="light" lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zoek Producten | Protein Mirror</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#2D4559",
              "background-light": "#f6f8f6",
              "background-dark": "#102215",
              "surface-light": "#ffffff",
              "surface-dark": "#1c2e21",
            },
            fontFamily: {
              display: ["Manrope", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.375rem",
              lg: "0.5rem",
              xl: "0.75rem",
              "2xl": "1rem",
              full: "9999px",
            },
          },
        },
      };
    </script>
    <style>
      .no-results {
        padding: 30px;
        text-align: center;
        color: #999;
      }

      .loading {
        text-align: center;
        padding: 30px;
        color: white;
      }

      .stats {
        color: white;
        text-align: center;
        margin-bottom: 20px;
        font-size: 0.9em;
      }
    </style>
  </head>
<body class="bg-[#2D4559] font-display text-white antialiased"></body>
    <div
      class="relative flex h-full min-h-screen w-full flex-col overflow-x-hidden pb-24"
    >
      <!-- Header -->
      <header
        class="sticky top-0 z-20 flex items-center justify-between bg-surface-light/90 dark:bg-surface-dark/90 px-4 py-3 backdrop-blur-md shadow-sm"
      >
        <h1
          class="text-xl font-extrabold leading-tight tracking-tight text-slate-900 dark:text-white"
        >
          Zoek Producten
        </h1>
      </header>

      <main class="flex-1 flex flex-col gap-4 py-4 px-4">
        <!-- Stats -->
        <div
          class="text-center text-sm text-slate-600 dark:text-slate-400"
          id="stats"
        >
          Laden...
        </div>

        <!-- Search Bar -->
        <div class="relative">
          <span
            class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
            >search</span
          >
          <input
            type="text"
            id="searchInput"
            placeholder="Zoek op productnaam..."
            autocomplete="off"
            class="w-full pl-11 pr-4 py-3 rounded-xl bg-surface-light dark:bg-surface-dark border border-slate-200 dark:border-slate-700 text-slate-900 dark:text-white font-medium focus:outline-none focus:ring-2 focus:ring-primary transition-all"
          />
        </div>

        <!-- Product List -->
        <!-- <div class="flex flex-col gap-2" id="productList"> -->
        <div id="productList" class="grid grid-cols-2 gap-4">
          <div class="text-center py-8 text-slate-600 dark:text-slate-400">
            Producten laden...
          </div>
        </div>
      </main>

      <!-- Bottom Navigation -->
      <nav
        class="fixed bottom-0 left-0 right-0 bg-white dark:bg-surface-dark border-t border-slate-200 dark:border-slate-800 z-30"
      >
        <div class="flex items-center justify-around h-16 max-w-lg mx-auto">
          <!-- Home -->
          <a
            href="home.html"
            class="flex flex-col items-center justify-center gap-1 flex-1 h-full text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
          >
            <span class="material-symbols-outlined text-[28px]">home</span>
            <span class="text-xs font-medium">Home</span>
          </a>

          <!-- Search (Active) -->
          <a
            href="Zoekpagina.html"
            class="flex flex-col items-center justify-center gap-1 flex-1 h-full text-primary transition-colors relative"
          >
            <span class="material-symbols-outlined text-[28px] font-bold"
              >search</span
            >
            <span class="text-xs font-bold">Zoek</span>
            <div
              class="absolute top-0 left-1/2 -translate-x-1/2 w-12 h-1 bg-primary rounded-b-full"
            ></div>
          </a>

          <!-- Compare -->
          <a
            href="index.html"
            class="flex flex-col items-center justify-center gap-1 flex-1 h-full text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
          >
            <span class="material-symbols-outlined text-[28px]"
              >compare_arrows</span
            >
            <span class="text-xs font-medium">Vergelijken</span>
          </a>

          <!-- Favourite -->
          <a
            href="#"
            class="flex flex-col items-center justify-center gap-1 flex-1 h-full text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
          >
            <span class="material-symbols-outlined text-[28px]">favorite</span>
            <span class="text-xs font-medium">Favorieten</span>
          </a>
        </div>
      </nav>
    </div>

    <script>
      let allProducts = [];

      function parseCSV(text) {
        const lines = text.trim().split("\n");
        const products = [];

        const clean = (v) =>
          v
            .replace(/^"+|"+$/g, "")
            .replace(/""/g, '"')
            .trim();

        for (let i = 1; i < lines.length; i++) {
          const row = lines[i];

          // split op kommaâ€™s buiten quotes
          const values = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];

          // ðŸ‘‰ afbeelding expliciet zoeken
          const imageValue =
            values.find(
              (v) => v.includes("static.ah.nl") && v.includes("fileType=binary")
            ) || "";

          products.push({
            Naam: clean(values[0] || "")
              .replace(/,+$/, "") // verwijdert trailing komma
              .replace(/"+$/, ""), // verwijdert trailing quotes
            Prijs: clean(values[1] || ""),
            Aanbieding: clean(values[2] || ""),
            "Eiwit per 100g": clean(values[3] || ""),
            "Koolhydraten per 100g": clean(values[4] || ""),
            "Vetten per 100g": clean(values[5] || ""),
            CalorieÃ«n: clean(values[6] || ""),
            Link: clean(values[7] || ""),
            Afbeelding: clean(imageValue),
            "Verzameld op": clean(
              values.find((v) => v.match(/\d{4}-\d{2}-\d{2}/)) || ""
            ),
          });
        }

        return products;
      }
      // Load CSV
      async function loadProducts() {
        try {
          const response = await fetch("alle_producten_samengevoegd.csv");
          if (!response.ok) throw new Error("CSV bestand niet gevonden");
          const text = await response.text();
          allProducts = parseCSV(text).filter((p) => p.Naam && p.Naam.trim());
          renderProducts(allProducts);
          updateStats();
        } catch (e) {
          console.error("Error loading CSV:", e);
          document.getElementById("productList").innerHTML =
            '<div class="text-center py-8 text-red-600 dark:text-red-400">Fout bij laden van producten: ' +
            e.message +
            "</div>";
        }
      }

      function renderProducts(products) {
        const list = document.getElementById("productList");

        if (!products || products.length === 0) {
          list.innerHTML =
            '<div class="text-center py-8 text-slate-500 dark:text-slate-400">Geen producten gevonden</div>';
          return;
        }

        list.innerHTML = products
          .map((p) => {
            /* =========================
         1. NAAM + PRIJS OPSCHONEN
         ========================= */

            let name = (p.Naam || "Onbekend product")
              .replace(/["]+/g, "") // verwijdert ALLE aanhalingstekens
              .replace(/,+$/g, "") // verwijdert kommaâ€™s aan het eind
              .trim();
            let price = p.Prijs || "";

            // Fix: prijs zit soms in de naam (door kapotte CSV quotes)
            if (name.includes("â‚¬")) {
              const parts = name.split("â‚¬");
              name = parts[0].replace(/,+$/, "").trim();
              price = "â‚¬" + parts[1].replace(/"/g, "").trim();
            }

            /* =========================
         2. AFBEELDING URL HARD FIX
         ========================= */

            let image = "";

            if (p.Afbeelding) {
              image = p.Afbeelding.replace(/^"+|"+$/g, "") // quotes weg
                .trim();

              const marker = "fileType=binary";
              if (image.includes(marker)) {
                image = image.substring(
                  0,
                  image.indexOf(marker) + marker.length
                );
              }
            }

            /* =========================
         3. HTML OUTPUT
         ========================= */

            return `
        <div
          class="flex items-center gap-4 p-4 rounded-xl bg-surface-light dark:bg-surface-dark
                 border border-slate-200 dark:border-slate-800 hover:shadow-md
                 hover:border-primary transition-all cursor-pointer"
          onclick="selectProduct('${encodeURIComponent(name)}')"
        >

          <div class="w-16 h-16 flex items-center justify-center bg-slate-100 rounded-lg">
            ${
              image
                ? `<img
                    src="${image}"
                    alt="${name}"
                    class="w-full h-full object-contain rounded-lg"
                    onerror="this.onerror=null; this.style.display='none'"
                  />`
                : `<span class="text-xs text-slate-400">No image</span>`
            }
          </div>

          <div class="flex-1">
            <div class="font-medium text-slate-900 dark:text-white">
              ${name}
            </div>
            ${price ? `<div class="text-sm text-slate-500">${price}</div>` : ""}
          </div>

        </div>
      `;
          })
          .join("");
      }
      // Select product
      function selectProduct(encodedName) {
        window.location.href = `Product_detail.html?id=${encodedName}`;
      }

      // Search
      document.getElementById("searchInput").addEventListener("input", (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allProducts.filter((p) =>
          (p.Naam || "").toLowerCase().includes(term)
        );
        renderProducts(filtered);
      });

      // Update stats
      function updateStats() {
        document.getElementById(
          "stats"
        ).textContent = `${allProducts.length} producten beschikbaar`;
      }

      // Initialize
      window.addEventListener("DOMContentLoaded", loadProducts);
    </script>
  </body>
</html>
