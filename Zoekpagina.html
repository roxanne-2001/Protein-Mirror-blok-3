<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Producten Selectie</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #2d4559;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
      }

      h1 {
        color: white;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .search-section {
        background: #e1dfdc;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .search-section input {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        margin-bottom: 10px;
      }

      .search-section input:focus {
        outline: none;
        border-color: #2d4559;
      }

      .product-list {
        background: #e1dfdc;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .product-item {
        padding: 15px;
        border-bottom: 1px solid #e1dfdc;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .product-item:last-child {
        border-bottom: none;
      }

      .product-item:hover {
        background: #e1dfdc;
        transform: translateX(5px);
      }

      .product-name {
        font-weight: 500;
        color: #333;
        flex: 1;
      }

      .product-price {
        color: #2d4559;
        font-weight: bold;
        margin-right: 10px;
      }

      .product-arrow {
        color: #2d4559;
        font-weight: bold;
      }

      .no-results {
        padding: 30px;
        text-align: center;
        color: #999;
      }

      .loading {
        text-align: center;
        padding: 30px;
        color: white;
      }

      .stats {
        color: white;
        text-align: center;
        margin-bottom: 20px;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Selecteer een Product</h1>

      <div class="stats" id="stats">Laden...</div>

      <div class="search-section">
        <input
          type="text"
          id="searchInput"
          placeholder="Zoek op productnaam..."
          autocomplete="off"
        />
      </div>

      <div class="product-list" id="productList">
        <div class="loading">Producten laden...</div>
      </div>
    </div>

    <script>
      let allProducts = [];

      // CSV parser
      function parseCSV(text) {
        const lines = text.trim().split("\n");
        const headers = lines[0].split(",").map((h) => h.trim());
        const products = [];

        for (let i = 1; i < lines.length; i++) {
          const line = lines[i];
          const values = [];
          let current = "";
          let inQuotes = false;

          for (let char of line) {
            if (char === '"') {
              inQuotes = !inQuotes;
            } else if (char === "," && !inQuotes) {
              values.push(current.trim());
              current = "";
            } else {
              current += char;
            }
          }
          values.push(current.trim());

          const obj = {};
          headers.forEach((h, idx) => (obj[h] = values[idx] || ""));
          products.push(obj);
        }

        return products;
      }

      // Load CSV
      async function loadProducts() {
        try {
          const response = await fetch("results_all.csv");
          if (!response.ok) throw new Error("CSV not found");
          const text = await response.text();
          allProducts = parseCSV(text).filter((p) => p.Naam && p.Naam.trim());
          renderProducts(allProducts);
          updateStats();
        } catch (e) {
          console.error("Error loading CSV:", e);
          document.getElementById("productList").innerHTML =
            '<div class="no-results">Fout bij laden van producten</div>';
        }
      }

      // Render products
      function renderProducts(products) {
        const list = document.getElementById("productList");

        if (products.length === 0) {
          list.innerHTML =
            '<div class="no-results">Geen producten gevonden</div>';
          return;
        }

        list.innerHTML = products
          .map((p) => {
            const price = p.Prijs || "€" + p.parsed_price_eur;
            const name = p.Naam || "Onbekend product";
            return `
                        <div class="product-item" onclick="selectProduct('${encodeURIComponent(
                          name
                        )}')">
                            <div class="product-name">${name}</div>
                            <div class="product-price">${price}</div>
                            <div class="product-arrow">→</div>
                        </div>
                    `;
          })
          .join("");
      }

      // Select product
      function selectProduct(encodedName) {
        window.location.href = `Product_detail.html?id=${encodedName}`;
      }

      // Search
      document.getElementById("searchInput").addEventListener("input", (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allProducts.filter((p) =>
          (p.Naam || "").toLowerCase().includes(term)
        );
        renderProducts(filtered);
      });

      // Update stats
      function updateStats() {
        document.getElementById(
          "stats"
        ).textContent = `${allProducts.length} producten beschikbaar`;
      }

      // Initialize
      window.addEventListener("DOMContentLoaded", loadProducts);
    </script>
  </body>
</html>
