<!DOCTYPE html>
<html class="light" lang="nl">

<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Product Vergelijker | Proteïne vs Normaal</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2D4559",
                        "background-light": "#f6f8f6",
                        "background-dark": "#102215",
                        "surface-light": "#ffffff",
                        "surface-dark": "#1c2e21",
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.375rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "2xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>

<body class="bg-[#2D4559] font-display text-white antialiased">
    <div class="relative flex h-full min-h-screen w-full flex-col overflow-x-hidden">
        <!-- Header -->
        <header class="sticky top-0 z-20 flex items-center justify-between bg-white/90 px-4 py-3 backdrop-blur-md shadow-sm">
            <h1 class="text-xl font-extrabold leading-tight tracking-tight text-slate-900">Vergelijker</h1>
            <div class="flex items-center gap-2">
                <button onclick="clearComparison()" class="flex h-10 w-10 items-center justify-center rounded-full bg-slate-100 text-slate-900 hover:bg-slate-200 transition-colors">
                    <span class="material-symbols-outlined text-[24px]">refresh</span>
                </button>
            </div>
        </header>

        <main class="flex-1 flex flex-col gap-6 py-4">
            <!-- Product Selection -->
            <div id="selection-section" class="px-4 flex flex-col gap-4">
                <div class="flex flex-col gap-2">
                    <label class="text-sm font-bold text-white">Selecteer Proteïne Product</label>
                    <select id="protein-select" class="w-full px-4 py-3 rounded-xl bg-white border border-slate-200 text-slate-900 font-medium focus:outline-none focus:ring-2 focus:ring-primary transition-all">
                        <option value="">Kies een proteïne product...</option>
                    </select>
                </div>
                
                <div class="flex flex-col gap-2">
                    <label class="text-sm font-bold text-white">Selecteer Normaal Product</label>
                    <select id="normal-select" class="w-full px-4 py-3 rounded-xl bg-white border border-slate-200 text-slate-900 font-medium focus:outline-none focus:ring-2 focus:ring-primary transition-all">
                        <option value="">Kies een normaal product...</option>
                    </select>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="px-4">
                <div class="relative">
                    <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">search</span>
                    <input 
                        type="text" 
                        id="search-input" 
                        placeholder="Zoek producten..." 
                        class="w-full pl-11 pr-4 py-3 rounded-xl bg-white border border-slate-200 text-slate-900 font-medium focus:outline-none focus:ring-2 focus:ring-primary transition-all"
                    />
                </div>
            </div>

            <!-- Per 100g Toggle -->
            <div class="px-4">
                <div class="flex h-12 w-full items-center justify-center rounded-xl bg-white p-1 shadow-sm">
                    <div class="flex h-full flex-1 items-center justify-center rounded-lg px-4">
                        <span class="text-sm font-bold text-slate-900">Per 100g</span>
                    </div>
                </div>
                <p class="mt-3 text-center text-xs font-medium text-white">
                    <span class="inline-block h-2 w-2 rounded-full bg-primary mr-1"></span>
                    Betere waarden worden gemarkeerd
                </p>
            </div>

            <!-- Comparison Cards -->
            <div id="comparison-container" class="flex flex-1 overflow-x-auto hide-scrollbar px-4 gap-3 snap-x pb-4 items-start hidden">
                <!-- Protein Product Card -->
                <div id="protein-card" class="relative min-w-[46%] max-w-[48%] flex-shrink-0 snap-center flex flex-col rounded-2xl bg-white shadow-lg border border-slate-100 overflow-hidden group">
                    <div class="aspect-[4/3] w-full bg-slate-100 dark:bg-slate-800 bg-cover bg-center relative" id="protein-image">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <div class="absolute top-2 left-2">
                            <span class="px-2 py-1 rounded-md bg-primary/90 text-white text-xs font-bold">PROTEÏNE</span>
                        </div>
                        <div class="absolute bottom-3 left-3 right-3">
                            <h3 id="protein-name" class="text-white text-lg font-bold leading-tight shadow-black drop-shadow-sm">-</h3>
                        </div>
                    </div>
                    <div class="flex flex-col p-3 gap-0">
                        <div class="flex flex-col gap-1 py-3 border-b border-slate-100 dark:border-slate-800 h-[72px] justify-center">
                            <span class="text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Eiwit</span>
                            <div class="flex items-center gap-2">
                                <span id="protein-eiwit" class="text-lg font-bold text-slate-900 dark:text-white">-</span>
                                <span id="protein-eiwit-badge" class="material-symbols-outlined text-primary text-[18px] hidden">trophy</span>
                            </div>
                        </div>
                        <div class="flex flex-col gap-1 py-3 border-b border-slate-100 dark:border-slate-800 h-[72px] justify-center">
                            <span class="text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Calorieën</span>
                            <div class="flex items-center gap-2">
                                <span id="protein-calories" class="text-lg font-bold text-slate-900 dark:text-white">-</span>
                                <span id="protein-cal-badge" class="material-symbols-outlined text-primary text-[18px] hidden">check_circle</span>
                            </div>
                        </div>
                        <div class="flex flex-col gap-1 py-3 border-b border-slate-100 dark:border-slate-800 h-[72px] justify-center">
                            <span class="text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Vetten</span>
                            <span id="protein-vetten" class="text-lg font-bold text-slate-900 dark:text-white">-</span>
                        </div>
                        <div class="flex flex-col gap-1 py-3 border-b border-slate-100 dark:border-slate-800 h-[72px] justify-center">
                            <span class="text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Koolhydraten</span>
                            <span id="protein-koolhydraten" class="text-lg font-bold text-slate-900 dark:text-white">-</span>
                        </div>
                        <div class="flex flex-col gap-1 pt-3 h-[60px] justify-center">
                            <span class="text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Prijs</span>
                            <div class="flex items-center gap-2">
                                <span id="protein-price" class="text-base font-bold text-slate-900 dark:text-white">-</span>
                                <span id="protein-offer" class="px-1.5 py-0.5 rounded bg-green-500 text-white text-[10px] font-bold hidden">DEAL</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Normal Product Card -->
                <div id="normal-card" class="relative min-w-[46%] max-w-[48%] flex-shrink-0 snap-center flex flex-col rounded-2xl bg-white shadow-lg border border-slate-100 overflow-hidden">
                    <div class="aspect-[4/3] w-full bg-slate-100 dark:bg-slate-800 bg-cover bg-center relative" id="normal-image">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <div class="absolute top-2 left-2">
                            <span class="px-2 py-1 rounded-md bg-slate-600/90 text-white text-xs font-bold">NORMAAL</span>
                        </div>
                        <div class="absolute bottom-3 left-3 right-3">
                            <h3 id="normal-name" class="text-white text-lg font-bold leading-tight shadow-black drop-shadow-sm">-</h3>
                        </div>
                    </div>
                    <div class="flex flex-col p-3 gap-0">
                        <div class="flex flex-col gap-1 py-3 border-b border-slate-100 dark:border-slate-800 h-[72px] justify-center">
                            <span class="text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Eiwit</span>
                            <div class="flex items-center gap-2">
                                <span id="normal-eiwit" class="text-lg font-bold text-slate-900 dark:text-white">-</span>
                                <span id="normal-eiwit-badge" class="material-symbols-outlined text-primary text-[18px] hidden">trophy</span>
                            </div>
                        </div>
                        <div class="flex flex-col gap-1 py-3 border-b border-slate-100 dark:border-slate-800 h-[72px] justify-center">
                            <span class="text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Calorieën</span>
                            <div class="flex items-center gap-2">
                                <span id="normal-calories" class="text-lg font-bold text-slate-900 dark:text-white">-</span>
                                <span id="normal-cal-badge" class="material-symbols-outlined text-primary text-[18px] hidden">check_circle</span>
                            </div>
                        </div>
                        <div class="flex flex-col gap-1 py-3 border-b border-slate-100 dark:border-slate-800 h-[72px] justify-center">
                            <span class="text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Vetten</span>
                            <span id="normal-vetten" class="text-lg font-bold text-slate-900 dark:text-white">-</span>
                        </div>
                        <div class="flex flex-col gap-1 py-3 border-b border-slate-100 dark:border-slate-800 h-[72px] justify-center">
                            <span class="text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Koolhydraten</span>
                            <span id="normal-koolhydraten" class="text-lg font-bold text-slate-900 dark:text-white">-</span>
                        </div>
                        <div class="flex flex-col gap-1 pt-3 h-[60px] justify-center">
                            <span class="text-xs font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400">Prijs</span>
                            <div class="flex items-center gap-2">
                                <span id="normal-price" class="text-base font-bold text-slate-900 dark:text-white">-</span>
                                <span id="normal-offer" class="px-1.5 py-0.5 rounded bg-green-500 text-white text-[10px] font-bold hidden">DEAL</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Links Section -->
            <div id="links-section" class="px-4 mt-auto hidden">
                <div class="flex flex-col gap-3">
                    <a id="protein-link" href="#" target="_blank" class="w-full rounded-xl bg-white text-slate-900 p-4 flex items-center justify-between group hover:bg-slate-100 transition-colors shadow-lg font-bold">
                        <span>Bekijk Proteïne Product</span>
                        <span class="material-symbols-outlined">arrow_forward</span>
                    </a>
                    <a id="normal-link" href="#" target="_blank" class="w-full rounded-xl bg-white text-slate-900 p-4 flex items-center justify-between group hover:bg-slate-100 transition-colors shadow-lg font-bold">
                        <span>Bekijk Normaal Product</span>
                        <span class="material-symbols-outlined">arrow_forward</span>
                    </a>
                </div>
            </div>

            <div class="h-20"></div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-surface-dark border-t border-slate-200 dark:border-slate-800 z-30">
            <div class="flex items-center justify-around h-16 max-w-lg mx-auto">
                <!-- Home -->
                <a href="home.html" class="flex flex-col items-center justify-center gap-1 flex-1 h-full text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">
                    <span class="material-symbols-outlined text-[28px]">home</span>
                    <span class="text-xs font-medium">Home</span>
                </a>
                
                <!-- Search -->
                <a href="Zoekpagina.html" class="flex flex-col items-center justify-center gap-1 flex-1 h-full text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">
                    <span class="material-symbols-outlined text-[28px]">search</span>
                    <span class="text-xs font-medium">Zoek</span>
                </a>
                
                <!-- Compare (Active) -->
                <a href="index.html" class="flex flex-col items-center justify-center gap-1 flex-1 h-full text-primary transition-colors relative">
                    <span class="material-symbols-outlined text-[28px] font-bold">compare_arrows</span>
                    <span class="text-xs font-bold">Vergelijken</span>
                    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-12 h-1 bg-primary rounded-b-full"></div>
                </a>
                
                <!-- Account -->
                <a href="Account.html" class="flex flex-col items-center justify-center gap-1 flex-1 h-full text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">
                    <span class="material-symbols-outlined text-[28px]">person</span>
                    <span class="text-xs font-medium">Account</span>
                </a>
            </div>
        </nav>
    </div>

    <script>
        console.log('=== INLINE SCRIPT STARTING ===');
        
        let allProducts = [];
        let proteinProducts = [];
        let normalProducts = [];

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const products = [];
            
            for (let i = 1; i < lines.length; i++) {
                let line = lines[i].trim();
                if (!line) continue;
                
                if (line.startsWith('"')) {
                    const endQuoteIndex = line.lastIndexOf('"');
                    if (endQuoteIndex > 0) {
                        line = line.substring(1, endQuoteIndex);
                    }
                }
                
                const values = [];
                let current = '';
                let inQuotes = false;
                let prevChar = '';
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    
                    if (char === '"' && prevChar === '"') {
                        current += char;
                        prevChar = '';
                        continue;
                    } else if (char === '"') {
                        inQuotes = !inQuotes;
                        prevChar = char;
                        continue;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                        prevChar = char;
                        continue;
                    }
                    
                    current += char;
                    prevChar = char;
                }
                
                values.push(current.trim());
                
                if (values.length >= 7) {
                    products.push({
                        'Naam': values[0] || '',
                        'Prijs': values[1] || '',
                        'Aanbieding': values[2] || '-',
                        'Eiwit per 100g': values[3] || '',
                        'Koolhydraten per 100g': values[4] || '',
                        'Vetten per 100g': values[5] || '',
                        'Calorieën': values[6] || '',
                        'Link': values[7] || '',
                        'Afbeelding': values[8] || ''
                    });
                }
            }
            return products;
        }

        function getProteinValue(proteinString) {
            const match = proteinString.match(/[\d.]+/);
            return match ? parseFloat(match[0]) : 0;
        }

        function getProductImageUrl(product) {
            if (product.Afbeelding && product.Afbeelding.trim()) {
                let image = product.Afbeelding.replace(/^"+|"+$/g, "").trim();
                const marker = "fileType=binary";
                if (image.includes(marker)) {
                    image = image.substring(0, image.indexOf(marker) + marker.length);
                }
                return image;
            }
            
            const productLink = product.Link;
            if (!productLink) return '';
            
            const match = productLink.match(/product\/(wi\d+)/);
            if (match && match[1]) {
                return `https://static.ah.nl/image-optimization/static/product/${match[1]}_40x40_JPG.JPG?quality=90&width=300`;
            }
            return '';
        }

        function compareProducts() {
            const i1 = document.getElementById('protein-select').value;
            const i2 = document.getElementById('normal-select').value;
            
            if (!i1 || !i2) return;
            
            const p1 = proteinProducts[i1];
            const p2 = normalProducts[i2];
            
            console.log('Vergelijken:', p1.Naam, 'vs', p2.Naam);
            
            document.getElementById('comparison-container').classList.remove('hidden');
            document.getElementById('links-section').classList.remove('hidden');
            
            // Set product data
            document.getElementById('protein-name').textContent = p1.Naam || '-';
            document.getElementById('protein-price').textContent = p1.Prijs || '-';
            document.getElementById('protein-eiwit').textContent = p1['Eiwit per 100g'] || '-';
            document.getElementById('protein-calories').textContent = p1['Calorieën'] || '-';
            document.getElementById('protein-vetten').textContent = p1['Vetten per 100g'] || '-';
            document.getElementById('protein-koolhydraten').textContent = p1['Koolhydraten per 100g'] || '-';
            
            document.getElementById('normal-name').textContent = p2.Naam || '-';
            document.getElementById('normal-price').textContent = p2.Prijs || '-';
            document.getElementById('normal-eiwit').textContent = p2['Eiwit per 100g'] || '-';
            document.getElementById('normal-calories').textContent = p2['Calorieën'] || '-';
            document.getElementById('normal-vetten').textContent = p2['Vetten per 100g'] || '-';
            document.getElementById('normal-koolhydraten').textContent = p2['Koolhydraten per 100g'] || '-';
            
            // Set images
            const p1ImageUrl = getProductImageUrl(p1);
            const p2ImageUrl = getProductImageUrl(p2);
            
            const proteinImg = document.getElementById('protein-image');
            const normalImg = document.getElementById('normal-image');
            
            if (p1ImageUrl) {
                proteinImg.style.backgroundImage = `url('${p1ImageUrl}')`;
                proteinImg.style.backgroundSize = 'cover';
                proteinImg.style.backgroundPosition = 'center';
            }
            
            if (p2ImageUrl) {
                normalImg.style.backgroundImage = `url('${p2ImageUrl}')`;
                normalImg.style.backgroundSize = 'cover';
                normalImg.style.backgroundPosition = 'center';
            }
            
            // Set links
            const proteinLink = document.getElementById('protein-link');
            const normalLink = document.getElementById('normal-link');
            
            if (proteinLink) proteinLink.href = p1.Link || '#';
            if (normalLink) normalLink.href = p2.Link || '#';
        }

        async function loadCSVData() {
            console.log('Laden CSV...');
            try {
                const response = await fetch('alle_producten_samengevoegd.csv');
                if (!response.ok) throw new Error('CSV niet gevonden');
                
                const csvText = await response.text();
                console.log('CSV geladen, grootte:', csvText.length);
                
                allProducts = parseCSV(csvText);
                console.log('Geparsed:', allProducts.length, 'producten');
                
                proteinProducts = allProducts.filter(p => getProteinValue(p['Eiwit per 100g']) >= 8);
                normalProducts = allProducts.filter(p => {
                    const protein = getProteinValue(p['Eiwit per 100g']);
                    return protein < 8 && protein > 0;
                });
                
                console.log('Proteïne:', proteinProducts.length, 'Normaal:', normalProducts.length);
                
                const sel1 = document.getElementById('protein-select');
                const sel2 = document.getElementById('normal-select');
                
                if (!sel1 || !sel2) {
                    alert('ERROR: Dropdowns niet gevonden!');
                    return;
                }
                
                proteinProducts.forEach((p, i) => {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.textContent = p.Naam.length > 60 ? p.Naam.substring(0, 60) + '...' : p.Naam;
                    sel1.appendChild(opt);
                });
                
                normalProducts.forEach((p, i) => {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.textContent = p.Naam.length > 60 ? p.Naam.substring(0, 60) + '...' : p.Naam;
                    sel2.appendChild(opt);
                });
                
                // Add event listeners
                sel1.addEventListener('change', compareProducts);
                sel2.addEventListener('change', compareProducts);
                
                console.log('KLAAR! Producten toegevoegd');
            } catch (e) {
                console.error('ERROR:', e);
                alert('ERROR: ' + e.message);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM ready!');
            loadCSVData();
        });
    </script>
</body>

</html>
